<%- layout('layouts/boilerplate')  %>


<style>
    #map {
        /* position: absolute;
        top: 0;
        bottom: 0;
        width: 100%; */
        height: 60vh;
    }
</style>


<a href="/form" class="btn btn-primary btn-lg mb-3">Add User Form</a>

<div id='map'></div>

<button id="fit" class="btn btn-warning mt-3">Fit to Singapore</button>
<!-- <style>
    #fit {
    display: block;
    position: relative;
    margin: 0px auto;
    padding: 15px;
    border: none;
    border-radius: 3px;
    font-size: 12px;
    text-align: center;
    color: #fff;
    background: #ee8a65;
    }
</style> -->

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiamVyZWxkbGltankiLCJhIjoiY2tqbnA3OW93MDBubjJycGs0cHpvM3kxcyJ9.HEU7FAlbGjqEJByAUP-A8g';
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/outdoors-v11', // stylesheet location
        center: [103.82, 1.364], // starting position [lng, lat]
        zoom: 11, // starting zoom
    });

    // Add geolocate control to the map
    map.addControl(
        new mapboxgl.GeolocateControl({
            positionOptions: {
            enableHighAccuracy: true
        },
            trackUserLocation: true
        })
    );

    document.getElementById('fit').addEventListener('click', function () {
        map.fitBounds([
            [103.6, 1.26],
            [104, 1.46]
        ]);
    });

    // adding markers
    // const marker = new mapboxgl.Marker()
    //     .setLngLat([103.8, 1.35])
    //     .addTo(map);
    
    // const test = <%- JSON.stringify(location) %>;
    // const newMarker = new mapboxgl.Marker()
    //     .setLngLat(test)
    //     .addTo(map)
    
    const visits = <%- JSON.stringify(visits) %>;

    visits.forEach(visit => {
        const newMarker = new mapboxgl.Marker()
        .setLngLat(visit.host.location)
        .setPopup(new mapboxgl.Popup().setHTML("<h3>" + visit.details + "</h3>"))
        .addTo(map)
    })
</script>
